<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name='viewport' content='width=640,user-scalable=no'/>
	<title>我真的是陈坤</title>
	<link rel="stylesheet" href="css/swiper.min.css">
	<link rel="stylesheet" href="css/animate.min.css">
	<link rel="stylesheet" href="css/index.css">
	<link rel="stylesheet" href="css/answer.css">
</head>
<body>
	<div id="container">
		<audio id="k_ring" preload="load" loop="loop" autoplay src="media/ring.mp3"></audio>
		<audio id="k_audio" preload="load" src="media/k_audio.mp3"></audio>
		<audio id="k_msg" preload="load" src="media/msg.mp3"></audio>
		<audio id="k_msg2" preload="load" src="media/msg.mp3"></audio>
		<div class="top">
			<img class="tonghua" src="img/tonghua.png" />
			<div class="touxiang_circle">
			</div>
			<div class="tonghua_dumiao">
				<div class="second">00:00</div>
				<canvas class="canvas" id="canvas_1" width="260" height="260" style="opacity:.4;"></canvas>
				<canvas class="canvas" id="canvas_2" width="260" height="260"></canvas>
			</div>
			<img class="touxiang" src="img/k_touxiang.png" />
			<img class="address" src="img/k_mingzi.png" />
		</div>

		<div class="jieting">
			<div class="jieting_btn">
				<div class="btn_inner"></div>
			</div>
		</div>

		<div class="keybord">
			<div class="hungUp_btn"></div>
		</div>

		<div class="message">
			<img class="msg_01" src="img/k_msg01.png"/>
			<img class="msg_02" src="img/k_msg02.png"/>
		</div>
	</div>

	<div id="mainSwiper" class="swiper-container">
	    <div class="swiper-wrapper">
	    	<!-- slide1 -->
	        <div class="swiper-slide page1">
	        	<img class="page1_img page1_title ani" swiper-animate-effect="rotateInUpLeft" swiper-animate-duration="0.8s" swiper-animate-delay="0s" src="img/p1_01.png"/>
	        	<img class="page1_img page1_icon ani" swiper-animate-effect="bounceInDown" swiper-animate-duration="0.6s" swiper-animate-delay="0.8s" src="img/p1_02.png"/>
	        	<img class="upArrow" src="img/upArrow.png"/>
	        </div>
	        <!-- slide2 -->
	        <div class="swiper-slide page2">
	        	<div class="page2_inner ani" swiper-animate-effect="bounceIn" swiper-animate-duration="0.6s" >
	        		<div class="page2_num page2_num1">5</div>
	        		<div class="page2_num page2_num2">5349</div>
	        		<div class="page2_num page2_num3">61℃</div>
	        		<div class="page2_num page2_num4">565</div>
	        		<div class="page2_num page2_num5">454</div>
	        		<div class="page2_num page2_num6">-<span class="num6_1">18</span>℃~<span class="num6_2">43</span>℃</div>
	        	</div>
	        	<img class="upArrow" src="img/upArrow.png"/>
	        </div>
	        <!-- slide3 -->
	        <div class="swiper-slide" id="page3">
	        	<div class="page3_1">
	        		<img class="p3_img p3_01" src="img/p3_01.png"/>
	        		<img class="p3_img p3_02" src="img/p3_02.png"/>
	        		<img class="p3_img p3_03" src="img/p3_03.png"/>
	        	</div>
	        	
	        	<div class="icon_box clearfix">
	        		<div class="icon_con">
	        			<img class="p3_icon" src="img/p3_04.png" />
	        		</div>
	        		<div class="icon_con">
	        			<img class="p3_icon" src="img/p3_06.png" />
	        		</div>
	        		<div class="icon_con">
	        			<img class="p3_icon" src="img/p3_07.png" />
	        		</div>
	        		<div class="icon_con">
	        			<img class="p3_icon" src="img/p3_08.png" />
	        		</div>
	        		<div class="icon_con">
	        			<img class="p3_icon" src="img/p3_09.png" />
	        		</div>
	        		<div class="icon_con">
	        			<img class="p3_icon" src="img/p3_10.png" />
	        		</div>
	        		<div class="icon_con">
	        			<img class="p3_icon" src="img/p3_11.png" />
	        		</div>
	        		<div class="icon_con">
	        			<img class="p3_icon" src="img/p3_12.png" />
	        		</div>
	        	</div>

				<img class="p3_img p3_13" src="img/p3_13.png" />

	        	<div class="page3_2">
	        		<img class="p3_img p3_14" src="img/p3_14.png" />
	        		<img class="p3_img p3_15" src="img/p3_15.png" />
	        		<img class="p3_img p3_16" src="img/p3_16.png" />
	        	</div>
	        	
	        	<img class="upArrow" src="img/upArrow.png"/>
	        </div>

	        <!-- slide4 -->
	        <div class="swiper-slide">
	        	<div class="page4_1">
	        		<img class="p4_01" src="img/p4_01.png" />
	        		<img class="p4_02" src="img/p4_02.png" />
	        		<img class="p4_03" src="img/p4_03.png" />
	        	</div>

	        	<div class="page4_2 clearfix">
	        		<div class="p4_icon_box">
	        			<img src="img/p4_04.png" />
	        		</div>
	        		<div class="p4_icon_box">
	        			<img src="img/p4_041.png" />
	        		</div>
	        		<div class="p4_icon_box">
	        			<img src="img/p4_05.png" />
	        		</div>
	        		<div class="p4_icon_box">
	        			<img src="img/p4_06.png" />
	        		</div>
	        		<div class="p4_icon_box">
	        			<img src="img/p4_07.png" />
	        		</div>
	        	</div>

	        	<div class="page4_3">
	        		<img src="img/p4_08.png" />
	        	</div>
	        	
	        	<img class="upArrow" src="img/upArrow.png"/>
	        </div>

	        <!-- slide5 -->
	        <div class="swiper-slide">
	        	<div class="page5_inner">
	        		<img class="p5_01" src="img/p5_01.png" />
	        		<img class="p5_02" src="img/p5_02.png" />
	        		<img class="p5_03" src="img/p5_03.png" />
	        		<img class="p5_04" src="img/p5_04.png" />
	        		<img class="p5_05" src="img/p5_05.png" />	
	        	</div>

	        	<img class="p5_06" src="img/p5_06.png" />
	        	<img class="upArrow" src="img/upArrow.png"/>
	        </div>

	        <!-- slide6 -->
	        <div class="swiper-slide">
	        	
	        	<div class="page6_inner">
	        		<img class="p6_01" src="img/p6_01.png" />
	        		<img class="p6_02" src="img/p6_02.png" />
	        		<div class="page6_mask"></div>
	        		<a class="p6_link p6_link1" href="http://weibo.com/p/100808553d765c79b571a085f83aae325240ab?k=2015%E8%A1%8C%E8%B5%B0%E7%9A%84%E5%8A%9B%E9%87%8F&from=526&_from_=huati_topic">
	        			<img src="img/p6_03.png" />
	        		</a>
	        		<a class="p6_link p6_link2" href="javascript:;">
	        			<img src="img/p6_04.png" />
	        		</a>
	        	</div>
	        	<img class="p6_05" src="img/p6_05.png" />

	        	

	        </div>
	    </div>
	</div>
	
	<script src="js/jquery-2.1.3.js"></script>
	<script src="js/swiper.jquery.min.js"></script>
	<script src="js/swiper.animate1.0.2.min.js"></script>
	<script type="text/javascript">
	$(function(){

		// 根据手机屏幕，缩放container
		var $win = $(window),
			$container = $("#container");
			
		function scaleContainer(){
		    var nWinW = $win.width(),
		        nWinH = $win.height(),
		        nScaleW,
		        nScaleH;

		    if(nWinH <= 480){
		    	if(nWinW > 640){
		    	    nWinW = 640;
		    	}
		    	if(nWinH > 1136){
		    	    nWinH = 1056;
		    	}

		    	nScaleW = nWinW/640;
		    	nScaleH = nWinH/1056;

		    	$container.css({
		    	    '-webkit-transform':'scale(' + nScaleW+',' + nScaleH+')',
		    	    'transform':'scale(' + nScaleW+',' + nScaleH+')'
		    	});
		    }
		    
		}

		scaleContainer();

		$win.resize(scaleContainer);

		var k_audio = document.getElementById("k_audio"),
			k_ring = document.getElementById("k_ring"),
			k_msg = document.getElementById("k_msg"),
			k_msg2 = document.getElementById("k_msg2");

		k_ring.play();


		// 挂断之后直接跳转到宣传页面
		$(document).on("touchstart",".hungUp_btn",function(){
			k_audio.pause();
			// window.location.href="answer.html";
			showSlide();
			$("#mainSwiper").addClass('on');
		});

		$(document).on("touchstart",function(e){
			e.preventDefault();
		});

		var $jieting = $(".jieting"),
			$jietingBtn = $(".jieting_btn"),
			$tonghua = $(".tonghua"),
			oLeft = $jietingBtn.position().left,  // 初始值
			nLeft,  
			nFix;   // 修正值

		$jietingBtn.on("touchstart",function(e){
			e.preventDefault();

			if(e.originalEvent){
				e = e.originalEvent;
			}
			var $this = $(this),
				touch = e.touches[0],
				nStartLeft = touch.pageX;

			nLeft = $this.position().left;
			nFix = nStartLeft - nLeft;

			$this.addClass("jieting_down");

			$(document).on("touchmove",function(e){

				if(e.originalEvent){
					e = e.originalEvent;
				}

				var touch = e.touches[0];

				nLeft = touch.pageX - nFix;

				if(nLeft <= -40){
					nLeft = -40;
				}
				if(nLeft >= 400){
					nLeft = 400;
				}

				$jietingBtn.css({'left':nLeft});

			}).on("touchend",function(e){

				$jietingBtn.removeClass("jieting_down");

				if(nLeft <= -15 || nLeft >= 380) {
					if(nLeft <= 15) {    // 挂断电话，跳转到信息页面
						$(".top").hide();
						$(".jieting").hide();
						$(".message").addClass("message_on");
						
						setTimeout(function(){
							k_msg.play();
							$(".msg_01").fadeIn(200);
						},600);
						setTimeout(function(){
							k_msg2.play();
							$(".msg_02").fadeIn(200);
						},2000);
						setTimeout(function(){
							// window.location.href="answer.html";
							showSlide();
							$("#mainSwiper").addClass('on');
						},4200);
					}
					if(nLeft >= 380){    // 接听电话，播放录音

						setTimeout(function(){
							k_audio.play();
						},800);
						

						$(".tonghua_dumiao").show();
						$(".touxiang_circle").hide();

						// 通话读秒圆弧背景
						var canvas_1 = document.getElementById("canvas_1"),
							ctx_1 = canvas_1.getContext('2d');

						ctx_1.strokeStyle = "#aaa";
						ctx_1.lineWidth = 3;
						ctx_1.beginPath();
						ctx_1.arc(130,130,124,-0.4*Math.PI,Math.PI*1.4);
						ctx_1.stroke();
						ctx_1.closePath();

						// 实时更新的圆弧
						var canvas_2 = document.getElementById("canvas_1"),
							ctx_2 = canvas_2.getContext('2d');

						ctx_2.strokeStyle = "#fff2b7";
						ctx_2.lineWidth = 3;

						var arc = -0.4,
							n = 1.8 / 600;
						
						var arcTimer = setInterval(function(){
							if(arc < 1.4){
								arc += n;
								ctx_2.beginPath();
								ctx_2.arc(130,130,124,-0.4*Math.PI,Math.PI*arc);
								ctx_2.stroke();
								ctx_2.closePath();
							}else{
								clearInterval(arcTimer);
							}
						},50);

						// 通话读秒
						var $second = $(".second"),
							secNum = 0;
						var secTimer = setInterval(function(){
							if(secNum < 30){
								secNum ++;
								var text = secNum < 10 ? "0" + secNum : secNum;
								$second.text("00:" + text);
							}else{
								clearInterval(secTimer);
								// 读秒（30）之后直接跳转到宣传页面
								// window.location.href="answer.html";
								showSlide();
								$("#mainSwiper").addClass('on');
							}
						},1000);
						
						setTimeout(function(){    // 延迟出现键盘
							$(".keybord").addClass("keybordUp");
							$tonghua.addClass("tonghua_show");
						},200);
					}

					$jieting.fadeOut(200);
					k_ring.pause();

				}else{
					$this.css({"left": oLeft});
				}

				// 取消document上的touchmove事件
				$(document).off("touchmove").off("touchend");
			});
		});


		function showSlide(){
			// 提示分享
			var $page6_mask = $(".page6_mask");
			$(document).on("click",".p6_link2",function(){
				$page6_mask.fadeIn(200);
			}).on("click",".page6_mask",function(){
				$(this).fadeOut(200);
			});

			
			// page1 随机背景色
			var aColors = ['#79dfbb','#5d72c9','#e7ae6e','#f5836e','#4f9abf'];

			function randColor(){
				rand = Math.floor(Math.random() * 5);
				$(".page1").css({"background-color":aColors[rand]});
			}
			randColor();
			
			// page2 数字变化
			var $p2_1 = $(".page2_num1"),
				$p2_2 = $(".page2_num2"),
				$p2_3 = $(".page2_num3"),
				$p2_4 = $(".page2_num4"),
				$p2_5 = $(".page2_num5"),
				$num6_1 = $(".num6_1"),
				$num6_2 = $(".num6_2"),

				// 定时器中变化的数字
				num1 = num2 = num3 = num4 = num5 = num6_1 = num6_2 = 0,
				
				// 定时器
				timer_num1, 
				timer_num2, 
				timer_num3, 
				timer_num4, 
				timer_num5, 
				timer_num6_1, 
				timer_num6_2;


			// swiper
			var mainSwiper = new Swiper("#mainSwiper",{
				direction: 'vertical',
				mousewheelContro: true,
				grabCursor : true,
			   	onInit: function(swiper){
			   		// swiperAnimateCache(swiper);
			   		swiperAnimate(swiper);
				},
			   	onSlideChangeEnd: function(swiper){
					swiperAnimate(swiper);
					if(swiper.activeIndex == 1){

						timer_num1 = setInterval(function(){
							if(num1 < 5) {
								num1 ++;
							}else{
								clearInterval(timer_num1);
							}
							
							$p2_1.text(num1);
						},500);

						timer_num2 = setInterval(function(){
							if(num2 < 5349) {
								num2 += 20;	
							}else{
								if(num2 != 5349) num2 = 5349;
								clearInterval(timer_num2);
							}

							$p2_2.text(num2);
						},10);

						timer_num3 = setInterval(function(){
							if(num3 < 61) {
								num3 += 1;
							}else{
								clearInterval(timer_num3);
							}

							var txt3 = num3 + "℃";
							$p2_3.text(txt3);
						},50);

						timer_num4 = setInterval(function(){
							if(num4 < 565) {
								num4 += 5;
							}else{
								clearInterval(timer_num4);
							}
							$p2_4.text(num4);
						},50);

						timer_num5 = setInterval(function(){
							if(num5 < 454) {
								num5 += 2;
							}else{
								clearInterval(timer_num5);
							}
							$p2_5.text(num5);
						},20);

						timer_num6_1 = setInterval(function(){
							if(num6_1 < 18) {
								num6_1 ++;
							}else{
								clearInterval(timer_num6_1);
							}
							$num6_1.text(num6_1);
						},150);

						timer_num6_2 = setInterval(function(){
							if(num6_2 < 43) {
								num6_2 ++;
							}else{
								clearInterval(timer_num6_2);
							}
							$num6_2.text(num6_2);
						},90);
					}
					if(swiper.activeIndex == 0){
						randColor();
					}
			    },
				onTransitionEnd: function(swiper){
					swiperAnimate(swiper);
			    }
			});
		}

	});
	
	</script>
</body>
</html>